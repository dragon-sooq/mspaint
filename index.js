(()=>{"use strict";function i(t,e,a){return(i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return;if(Reflect.construct.sham)return;if("function"==typeof Proxy)return 1;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),1}catch(t){}}()?Reflect.construct.bind():function(t,e,a){var i=[null];return i.push.apply(i,e),e=new(Function.bind.apply(t,i)),a&&o(e,a.prototype),e}).apply(null,arguments)}function o(t,e){return(o=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function j(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var a=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=a){var i,o,n,r,l=[],s=!0,c=!1;try{if(n=(a=a.call(t)).next,0===e){if(Object(a)!==a)return;s=!1}else for(;!(s=(i=n.call(a)).done)&&(l.push(i.value),l.length!==e);s=!0);}catch(t){c=!0,o=t}finally{try{if(!s&&null!=a.return&&(r=a.return(),Object(r)!==r))return}finally{if(c)throw o}}return l}}(t,e)||a(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function b(t){return function(t){if(Array.isArray(t))return r(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||a(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(t,e){var a;if(t)return"string"==typeof t?r(t,e):"Map"===(a="Object"===(a=Object.prototype.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:a)||"Set"===a?Array.from(t):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?r(t,e):void 0}function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,i=new Array(e);a<e;a++)i[a]=t[a];return i}function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function l(t,e){for(var a,i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,"symbol"===n(a=function(t,e){if("object"!==n(t)||null===t)return t;var a=t[Symbol.toPrimitive];if(void 0===a)return("string"===e?String:Number)(t);if("object"!==n(a=a.call(t,e||"default")))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}(a=o.key,"string"))?a:String(a),o)}}function t(t,e,a){e&&l(t.prototype,e),a&&l(t,a),Object.defineProperty(t,"prototype",{writable:!1})}function H(t){return document.querySelector(t)}function B(t){return document.querySelectorAll(t)}function h(t,e){H(t).insertAdjacentHTML("beforeend",e)}function S(t,e,a,i,o){t.strokeStyle=o,t.lineWidth=i,t.beginPath(),t.moveTo(e[0],e[1]),t.lineTo(a[0],a[1]),t.stroke()}function P(t,e,a,i,o,n){t.strokeStyle=o,t.lineWidth=1;var o=(a[0]-e[0])/2,a=(a[1]-e[1])/2,r=e[0],e=e[1];t.beginPath(),1===i?(t.ellipse(r+o,e+a,Math.abs(o),Math.abs(a),Math.PI/180,0,2*Math.PI),t.stroke()):2===i?(t.fillStyle=n,t.ellipse(r+o,e+a,Math.abs(o),Math.abs(a),Math.PI/180,0,2*Math.PI),t.closePath(),t.fill(),t.stroke()):3===i&&(t.fillStyle=n,i=r+o,n=e+a,t.closePath(),t.ellipse(i,n,Math.abs(o),Math.abs(a),Math.PI/180,0,2*Math.PI),t.fill())}function A(t,e,a,i,o,n){var r,l,s=a[0]-e[0],c=a[1]-e[1];t.strokeStyle=o,t.fillStyle=n,t.lineWidth=1,t.beginPath(),20<Math.abs(s)&&20<Math.abs(c)?(t.beginPath(),l=a,t.ellipse((r=e)[0]+(s=0<s?10:-10),r[1]+(c=0<c?10:-10),Math.abs(s),Math.abs(c),Math.PI/180,+Math.PI,1.5*Math.PI),t.ellipse(l[0]-s,r[1]+c,Math.abs(s),Math.abs(c),Math.PI/180,1.5*Math.PI,0*Math.PI),t.ellipse(l[0]-s,l[1]-c,Math.abs(s),Math.abs(c),Math.PI/180,0,.5*Math.PI),t.ellipse(r[0]+s,l[1]-c,Math.abs(s),Math.abs(c),Math.PI/180,.5*Math.PI,+Math.PI),t.moveTo(e[0],a[1]-c),t.lineTo(e[0],e[1]+c),1===i?(t.closePath(),t.stroke()):2===i?(t.closePath(),t.fill(),t.stroke()):3===i&&(t.closePath(),t.fill())):D(t,e,a,type,o,n)}function D(t,e,a,i,o,n){t.strokeStyle=o,t.fillStyle=n,t.lineWidth=1,t.beginPath();var r,l,o=a[0]-e[0],n=a[1]-e[1],a=e[0],e=e[1];1===i?t.strokeRect(a,e,o,n):2===i?(t.strokeRect(a,e,o,n),t.fillRect(a+(r=0<o?1:-1),e+(l=0<n?1:-1),o-2*r,n-2*l)):3===i&&t.fillRect(a,e,o,n)}function I(t,e,a,i,o,n){var r=n,l=n;if(t.beginPath(),t.strokeStyle=lineColor,"左撇"===o)if("down"===i)t.moveTo(e[0],e[1]),t.lineTo(e[0]-r,e[1]+l),t.stroke();else for(var s=0;s<r;s++){var c=e[0]-s,h=e[1]+s,g=a[0]-s,d=a[1]+s;t.moveTo(c,h),t.lineTo(g,d),t.stroke()}else if("右撇"===o)if("down"===i)t.moveTo(e[0],e[1]),t.lineTo(e[0]+r,e[1]+l),t.stroke();else for(var u=0;u<r;u++){var y=e[0]+u,p=e[1]+u,f=a[0]+u,x=a[1]+u;t.moveTo(y,p),t.lineTo(f,x),t.stroke()}else if("十字圆"===o)if("down"===i){console.log("十字圆--");var n=e[0],v=e[1];console.log(n,v,r),t.arc(n-r,v-r,r,0,2*Math.PI,!1),t.fill()}else for(var m=e[0],C=e[1],w=a[0],k=a[1],T=10;T<=100;T+=10){var b=T/100;t.arc(m+b*(w-m)-r,C+b*(k-C)-r,r,0,2*Math.PI,!1),t.fill()}else if("方形"===o)if(console.log("fhxy"),"down"===i)n=e[0],v=e[1],t.fillRect(n-r/2,v-r/2,r,l);else for(var S=e[0],P=e[1],A=a[0],D=a[1],I=10;I<=100;I+=10){var R=I/100;t.fillRect(S+R*(A-S)-r/2,P+R*(D-P)-r/2,r,l)}}function R(t,e,a){console.log("circleR",a),t.beginPath();for(var i,o,n,r=0,l=a,s={3:16,7:36,12:70}[l],c=e[0]-l,h=e[1]-l;r<s;){var g=c+Math.random()*l*2,d=h+Math.random()*l*2;i=e,o=[g,d],n=l,Math.pow(i[0]-o[0],2)+Math.pow(i[1]-o[1],2)<n*n&&(t.fillRect(g,d,1,1),r+=1)}t.closePath()}var s=["rgb(0, 0, 0)","rgb(128, 128, 128)","rgb(128, 0, 0)","rgb(128, 128, 0)","rgb(0, 128, 0)","rgb(0, 128, 128)","rgb(0, 0, 128)","rgb(128, 0, 128)","rgb(128, 128, 64)","rgb(0, 64, 64)","rgb(0, 128, 255)","rgb(0, 64, 128)","rgb(64, 0, 255)","rgb(128, 64, 0)","rgb(255, 255, 255)","rgb(192, 192, 192)","rgb(255, 0, 0)","rgb(255, 255, 0)","rgb(0, 255, 0)","rgb(0, 255, 255)","rgb(0, 0, 255)","rgb(255, 0, 255)","rgb(255, 255, 128)","rgb(0, 255, 128)","rgb(128, 255, 255)","rgb(128, 128, 255)","rgb(255, 0, 128)","rgb(255, 128, 64)"];t(y,[{key:"dashMode",value:function(t){t?(this.paint.realContext.setLineDash([4,2]),this.paint.tempContext.setLineDash([4,2])):(this.paint.realContext.setLineDash([]),this.paint.tempContext.setLineDash([]))}},{key:"usePencil",value:function(t,e,a,i,o){t.strokeStyle=o,t.lineWidth=i,t.beginPath(),t.moveTo(e[0],e[1]),t.lineTo(a[0],a[1]),t.stroke()}},{key:"cancelRandomClip",value:function(){this.clipArea=null,this.clipAreaPoint=[],this.paint.tempContext.clearRect(0,0,this.paint.tempCanvas.width,this.paint.tempCanvas.height)}},{key:"useRandomClip",value:function(t,e,a,i){var o=this.clipArea,n=this.clipAreaPoint,r=this.paint.realContext,l=this.paint.tempContext,s=this.paint.lineColor;if("down"===i)if(o){var c=n[0][0],h=n[0][0],g=n[0][1],d=n[0][1];if(n.forEach(function(t){c=t[0]<c?t[0]:c,g=t[1]<g?t[1]:g,h=t[0]>h?t[0]:h,d=t[1]>d?t[1]:d}),e[0]>=c&&e[0]<=h&&e[1]>=g&&e[1]<=d){if(o.selected=!0,c-=5,g-=5,h+=5,d+=5,o.start=[c,g],o.end=[h,d],o.w=h-c,o.h=d-g,o&&!o.imgData){for(var u=r.getImageData(o.start[0],o.start[1],o.w,o.h),y=new ImageData(Uint8ClampedArray.from(u.data),u.width,u.height),p=new ImageData(Uint8ClampedArray.from(u.data),u.width,u.height),f=(o.imgData=u,o.imgDataStick=y,o.imgData1=p,[]),x=0;x<o.imgData.height;x++)for(var v=0;v<o.imgData.width;v++){var m=v+o.start[0],C=x+o.start[1];l.isPointInPath(m,C)?(f.push([m,C]),o.imgDataStick.data[4*(x*o.imgDataStick.width+v)-1+1]=255,o.imgDataStick.data[4*(x*o.imgDataStick.width+v)-1+2]=255,o.imgDataStick.data[4*(x*o.imgDataStick.width+v)-1+3]=255,o.imgDataStick.data[4*(x*o.imgDataStick.width+v)-1+4]=255,o.imgData1.data[4*(x*o.imgData1.width+v)-1+1]=255,o.imgData1.data[4*(x*o.imgData1.width+v)-1+2]=255,o.imgData1.data[4*(x*o.imgData1.width+v)-1+3]=255,o.imgData1.data[4*(x*o.imgData1.width+v)-1+4]=0):(o.imgData.data[4*(x*o.imgData.width+v)-1+1]=0,o.imgData.data[4*(x*o.imgData.width+v)-1+2]=0,o.imgData.data[4*(x*o.imgData.width+v)-1+3]=0,o.imgData.data[4*(x*o.imgData.width+v)-1+4]=0)}o.needChangePoi=f,o.clipAreaPoint=n}this.strockRect(t,o.start[0],o.start[1],o.w,o.h,!0,1),console.log("points.length--",o.clipAreaPoint.length)}else console.log("cancel clip"),this.cancelRandomClip()}else n.push(b(e)),t.strokeStyle=s,t.lineWidth=1,t.beginPath(),t.moveTo(e[0],e[1]);else"move"===i?o&&o.selected?(o.cliped||(r.putImageData(o.imgDataStick,o.start[0],o.start[1]),o.cliped=!0),this.moveRandomClipArea(this.paint.tempContext,o,e,a,!0)):(n.push(b(a)),t.lineTo(a[0],a[1]),t.stroke()):"up"===i&&(o&&o.selected?(this.moveRandomClipArea(r,o,e,a,!1),this.cancelRandomClip()):(t.closePath(),t.stroke(),this.clipArea={}))}},{key:"enCirclePath",value:function(t,e,a){t.beginPath(),t.linewidth=1,t.strokeStyle=this.paint.lineColor;var i=0,o=0;a&&(i=this.clipArea.curStart[0]-this.clipArea.start[0],o=this.clipArea.curStart[1]-this.clipArea.start[1]),t.moveTo(e[0][0]+i,e[0][1]+o);for(var n=1;n<e.length;n++){var r=i+e[n][0],l=o+e[n][1];t.lineTo(r,l)}t.closePath(),t.stroke()}},{key:"moveRandomClipArea",value:function(t,e,a,i,o){var n=i[0]-a[0],i=i[1]-a[1],a=[e.start[0]+n,e.start[1]+i];e.curStart=a,this.drawRandomWhiteRect(t,e,e.imgDataStick,o),this.drawRandomClipImgData(t,e,e.imgData,o)}},{key:"drawRandomWhiteRect",value:function(t,e,a,i){i&&(this.strockRect(t,e.start[0],e.start[1],e.w,e.h,!0,1),this.enCirclePath(t,e.clipAreaPoint,!1))}},{key:"drawRandomDashRect",value:function(t,e){t.strokeStyle=this.paint.lineColor,t.setLineDash([4,2]),t.lineDashOffset=0,t.beginPath(),t.strokeRect(e.curStart[0],e.curStart[1],e.w,e.h),t.stroke()}},{key:"drawRandomClipImgData",value:function(t,r,e,a){if(a)t.putImageData(e,r.curStart[0],r.curStart[1]),this.enCirclePath(t,r.clipAreaPoint,!0),this.drawRandomDashRect(t,r);else{for(var l=this.paint.realContext.getImageData(r.curStart[0],r.curStart[1],r.w,r.h),s=0;s<r.imgData.height;s++)for(var c=0;c<r.imgData.width;c++)!function(){var t,e,a,i,o=c+r.start[0],n=s+r.start[1];r.needChangePoi.find(function(t){return t[0]===o&&t[1]===n})&&(t=r.imgData.data[4*(s*r.imgData.width+c)-1+1],e=r.imgData.data[4*(s*r.imgData.width+c)-1+2],a=r.imgData.data[4*(s*r.imgData.width+c)-1+3],i=r.imgData.data[4*(s*r.imgData.width+c)-1+4],l.data[4*(s*r.imgData.width+c)-1+1]=t,l.data[4*(s*r.imgData.width+c)-1+2]=e,l.data[4*(s*r.imgData.width+c)-1+3]=a,l.data[4*(s*r.imgData.width+c)-1+4]=i)}();t.putImageData(r.imgData1,r.start[0],r.start[1]),t.putImageData(l,r.curStart[0],r.curStart[1])}}},{key:"useRectClip",value:function(t,e,a,i){var o=this.clipArea,n=a[0]-e[0],r=a[1]-e[1];if("down"===i){if(o)if(e[0]>=o.start[0]&&e[0]<=o.end[0]&&e[1]>=o.start[1]&&e[1]<=o.end[1]){o.selected=!0,console.log("选中");var l=this.paint.realContext.getImageData(o.start[0],o.start[1],o.w,o.h);o.imgData=l,o.imgDataStick=new ImageData(Uint8ClampedArray.from(l.data),l.width,l.height);for(var s=0;s<o.imgData.height;s++)for(var c=0;c<o.imgData.width;c++)o.imgDataStick.data[4*(s*o.imgDataStick.width+c)-1+1]=0,o.imgDataStick.data[4*(s*o.imgDataStick.width+c)-1+2]=0,o.imgDataStick.data[4*(s*o.imgDataStick.width+c)-1+3]=0,o.imgDataStick.data[4*(s*o.imgDataStick.width+c)-1+4]=0}else this.cancelRandomClip()}else"move"===i?o?o.selected&&(o.cliped||(o.cliped=!0,console.log("---stcik",o.start),this.paint.realContext.putImageData(o.imgDataStick,o.start[0],o.start[1])),this.moveClipArea(o,e,a)):this.strockRect(t,e[0],e[1],n,r,!0,1):"up"===i&&(o?o.selected&&(l=this.paint.realContext,this.stickClipArea(l,o)):(this.strockRect(t,e[0],e[1],n,r,!0,1),this.clipArea={start:e,end:a,w:n,h:r},console.log("up start",e)))}},{key:"strockRect",value:function(t,e,a,i,o,n,r){t.lineWidth=r,t.strokeStyle=this.paint.lineColor,n&&(t.setLineDash([4,2]),t.lineDashOffset=0),t.beginPath(),t.strokeRect(e,a,i,o),t.closePath(),t.stroke()}},{key:"stickClipArea",value:function(t,e){this.drawWhiteRect(t,e,!1),t.putImageData(e.imgData,e.curStart[0],e.curStart[1])}},{key:"moveClipArea",value:function(t,e,a){var i=this.paint.tempContext,o=this.paint.realContext,n=a[0]-e[0],a=a[1]-e[1],e=[t.start[0]+n,t.start[1]+a];t.curStart=e,this.drawWhiteRect(i,t,!0),this.drawClipImgData(o,t)}},{key:"drawWhiteRect",value:function(t,e,a){a&&this.strockRect(t,e.start[0],e.start[1],e.w,e.h,!0,1)}},{key:"drawClipImgData",value:function(t,e){this.paint.tempContext.putImageData(e.imgData,e.curStart[0],e.curStart[1]),this.strockRect(this.paint.tempContext,e.curStart[0],e.curStart[1],e.w,e.h,!0,1)}},{key:"drawDashRect",value:function(t,e){var a=this.paint.lineColor;t.strokeStyle=a,t.setLineDash([4,2]),t.lineDashOffset=0,t.beginPath(),t.strokeRect(e.curStart[0],e.curStart[1],e.w,e.h),t.stroke()}},{key:"useText",value:function(t,e,a,i){var o,n=this,r=this.textareaPoi,l=this.recordText,s=a[0]-e[0],c=a[1]-e[1];t.lineWidth=1,"move"!==i||r.start.length?"up"!==i||this.textareaPoi.start.length?"up"===i?this.recordText&&this.endRecord?(console.log("录入"),this.recordText=!1,this.paint.setRecordText(!1),this.textareaPoi={start:[],end:[],txtStart:[],cursorStart:[],txtValue:"",stringArr:[]},this.endRecord=!1):this.drawTxtBorder(t):"down"===i&&this.textareaPoi.start.length&&(g(e,r.start,r.end)?this.recordText||(console.log("curdor down",r),this.recordText=!0,this.paint.setRecordText(!0),o=255,this.textTimer=setInterval(function(){o<=0&&(o=255),o-=80,n.reDraw(t,o)},1e3/3)):l&&(i=this.paint.tempCanvas,t.clearRect(0,0,i.width,i.height),r=this.textareaPoi.end[0]-this.textareaPoi.start[0],l=this.textareaPoi.end[1]-this.textareaPoi.start[1],(i=this.paint.realContext).fillStyle="white",i.beginPath(),i.fillRect(this.textareaPoi.start[0],this.textareaPoi.start[1],r,l),i.closePath(),i.fill(),this.drawText(i),console.log("this.textTimer",this.textTimer),clearInterval(this.textTimer),this.endRecord=!0)):(t.fillStyle="white",t.setLineDash([]),t.lineDashOffset=0,t.beginPath(),t.fillRect(e[0],e[1],s,c),t.closePath(),t.fill(),t.strokeRect(e[0],e[1],s,c),t.stroke(),this.textareaPoi.start=b(e),this.textareaPoi.end=b(a),console.log("--useText up")):(t.setLineDash([4,2]),t.lineDashOffset=0,t.beginPath(),t.strokeRect(e[0],e[1],s,c),t.stroke())}},{key:"reDraw",value:function(t,e){var a=this.paint.tempCanvas;t.clearRect(0,0,a.width,a.height),this.drawTxtBorder(t),this.drawText(t),this.drawCursor(t,e)}},{key:"drawText",value:function(i){var o=this,n=this.textareaPoi;n.stringArr.forEach(function(t,e){var a=n.start[0],e=n.start[1]+26*(e+1)-3;i.fillStyle=o.paint.lineColor,i.font="".concat(20,"px Consolas"),i.fillText(t.text,a,e)})}},{key:"drawCursor",value:function(t,e){var a=0,i=((n=this.textareaPoi).stringArr.length&&(a=n.stringArr.length-1),n.stringArr[a]?n.stringArr[a].text:""),o=i=n.start[0]+t.measureText(i).width+1,n=n.start[1]+26*(a+1)+2,a=i,i=n-20-3;this.dashMode(!1),t.beginPath(),t.strokeStyle="rgba(0,0,0,".concat(e,")"),t.moveTo(o,n),t.lineTo(a,i),t.stroke()}},{key:"drawTxtBorder",value:function(t){var e=this.textareaPoi.end[0]-this.textareaPoi.start[0],a=this.textareaPoi.end[1]-this.textareaPoi.start[1];t.fillStyle="white",t.beginPath(),t.fillRect(this.textareaPoi.start[0],this.textareaPoi.start[1],e,a),t.closePath(),t.fill(),this.dashMode(!0),t.strokeStyle=this.paint.lineColor,t.strokeRect(this.textareaPoi.start[0],this.textareaPoi.start[1],e,a),t.stroke()}},{key:"useCurve3",value:function(t,e,a,i,o,n,r){t.strokeStyle=n||this.paint.lineColor,t.lineWidth=r||this.paint.lineWidth,t.beginPath(),t.moveTo(e[0],e[1]),t.bezierCurveTo(i[0],i[1],o[0],o[1],a[0],a[1]),t.stroke()}},{key:"useCurve2",value:function(t,e,a,i){t.strokeStyle=this.paint.lineColor,t.lineWidth=this.paint.lineWidth,t.beginPath(),t.moveTo(e[0],e[1]),t.quadraticCurveTo(i[0],i[1],a[0],a[1]),t.stroke(),this.curvePoint.lineWidth=this.paint.lineWidth,this.curvePoint.lineColor=this.paint.lineColor}},{key:"initCurveConfig",value:function(){this.saveCurve(),this.drawSavedCurve(),this.curvePoint={start:[],end:[],cp1:[],cp2:[]},this.curveStrightLineExist=!1,this.changeCpPoint=""}},{key:"saveCurve",value:function(){var t;this.curvePoint.start.length&&(t=JSON.parse(JSON.stringify(this.curvePoint)),this.curveArr.push(t))}},{key:"drawSavedCurve",value:function(){var e=this,a=this.paint.realContext;this.curveArr.forEach(function(t){t.cp2.length?e.useCurve3(a,t.start,t.end,t.cp1,t.cp2,t.lineWidth,t.lineColor):t.cp1.length?e.useCurve2(a,t.start,t.end,t.cp1,t.lineWidth,t.lineColor):S(a,t.start,t.end,t.lineWidth,t.lineColor)}),this.curveArr=[]}},{key:"usePolygon",value:function(t,e,a,i,o,n){var r=this.paint.graphicsType,o=(t.strokeStyle=o,t.lineWidth=1,this.paint.realContext);t===o?this.realContextMoveTo||(t.beginPath(),this.realContextMoveTo=!0,t.moveTo(e[0],e[1])):(t.beginPath(),t.moveTo(e[0],e[1])),t.lineTo(a[0],a[1]),1===r?(i&&t===o&&(this.realContextMoveTo=!1,t.closePath()),t.stroke()):2===r?(t.fillStyle=n,i&&t===o&&(this.realContextMoveTo=!1,t.closePath(),t.fill("evenodd")),t.stroke()):3===r&&(t.fillStyle=n,t.strokeStyle=n,i&&t===o?(this.realContextMoveTo=!1,t.closePath(),t.fill("evenodd")):t.stroke())}},{key:"saveImg",value:function(){console.log("save"),new Image;var t=this.paint.realCanvas.toDataURL("image/png"),e=document.createElement("a");e.href=t,e.download="testimg.png",e.click()}}]);var c=y,g=function(t,e,a){var i=t[0]>e[0]&&t[0]<a[0],e=t[1]>e[1]&&t[1]<a[1];return i&&e},N=function(t,e,a,i,o,n){var r=function(t,e,a){for(var i={},o=t.x;0<o;o--){var n=a.getImageData(o,t.y,1,1),r=n.data[0],l=n.data[1],s=n.data[2],n=n.data[3];if(r!==e[0]||l!==e[1]||s!==e[2]||n!==e[3]){i.x=o+1,i.y=t.y;break}}return i}(t,e,o),t=function(t,e,a,i){for(var o={},n=t.x;n<i.width;n++){var r=a.getImageData(n,t.y,1,1),l=r.data[0],s=r.data[1],c=r.data[2],r=r.data[3];if(l!==e[0]||s!==e[1]||c!==e[2]||r!==e[3]){o.x=n-1,o.y=t.y;break}}return o}(t,e,o,n),l="".concat(r.x,"-").concat(r.y);if(!a[l]){a[l]=!0,i.push({left:r,right:t});var l=r,s=t,c=e,h=a,g=i,d=o,u=n,y={x:l.x,y:l.y-1},p=d.getImageData(y.x,y.y,1,1).data,f=!0;for(30===y.y&&31===y.x&&console.log("a.y",y.y,p[0],p[1],p[2],p[3]);p[0]!==c[0]||p[1]!==c[1]||p[2]!==c[2]||p[3]!==c[3];){if(30===y.y&&31===y.x&&console.log("---a.y",y.y,p[0],p[1],p[2],p[3]),y.x+=1,y.x>=s.x){--y.x,f=!1;break}p=d.getImageData(y.x,y.y,1,1).data}f&&(30===y.y&&console.log("---findAllLines a.y"),N(y,c,h,g,d,u));for(var x=r,l=t,v=e,h=a,g=i,m=o,u=n,C={x:l.x,y:l.y-1},w=m.getImageData(C.x,C.y,1,1).data,k=!0;w[0]!==v[0]||w[1]!==v[1]||w[2]!==v[2]||w[3]!==v[3];){if(--C.x,C.x<=x.x){C.x+=1,k=!1;break}w=m.getImageData(C.x,C.y,1,1).data}k&&N(C,v,h,g,m,u);for(var l=r,T=t,b=e,h=a,g=i,S=o,u=n,P={x:l.x,y:l.y+1},A=S.getImageData(P.x,P.y,1,1).data,D=!0;A[0]!==b[0]||A[1]!==b[1]||A[2]!==b[2]||A[3]!==b[3];){if(P.x+=1,P.x>=T.x){--P.x,D=!1;break}A=S.getImageData(P.x,P.y,1,1).data}D&&N(P,b,h,g,S,u);for(var I=r,l=t,R=e,h=a,g=i,M=o,u=n,L={x:l.x,y:l.y+1},E=M.getImageData(L.x,L.y,1,1).data,W=!0;E[0]!==R[0]||E[1]!==R[1]||E[2]!==R[2]||E[3]!==R[3];){if(--L.x,L.x<=I.x){L.x+=1,W=!1;break}E=M.getImageData(L.x,L.y,1,1).data}W&&N(L,R,h,g,M,u)}};t(u,[{key:"setup",value:function(){this.initCommonArg(),this.initFrame(),this.initBottomColor(),this.initFrontEndColor(),this.addListener()}},{key:"initCommonArg",value:function(){var t=this;this.penhuCount=6,this.lineWidthArr=[1,2,3,4,5],this.nowArgIndex=0,this.fillColor="rgb(255, 255, 255)",this.lineColor="rgb(0, 0, 0)",this.lineWidth=1,this.toolTypeName=[{chinese:"不规则剪切",english:"",tag:""},{chinese:"矩形剪切",english:"",tag:""},{chinese:"橡皮擦",english:"",args:[4,6,8,12],insertArgHtml:t.eraserArg.bind(t),selectedClassName:"eraserLine-selected"},{chinese:"填充",english:""},{chinese:"取色器",english:""},{chinese:"放大镜",english:"",args:[{x:1,w:2},{x:2,w:4},{x:6,w:6},{x:8,w:12}],selectedClassName:"magnifier-selected",insertArgHtml:t.magnifierArg.bind(t)},{chinese:"铅笔",english:"",tag:"pencil"},{chinese:"笔刷",english:"",selectedClassName:"brush-selected",insertArgHtml:t.brushArg.bind(t),args:[{"十字圆":[4,2,1]},{"方形":[8,5,2]},{"左撇":[10,7,3]},{"右撇":[10,7,3]}]},{chinese:"喷枪",english:"",args:[1,2,3],selectedClassName:"airBrush-selected",insertArgHtml:t.airBrushArg.bind(t)},{chinese:"文字",english:""},{chinese:"直线",english:"",args:[1,2,3,4,5],selectedClassName:"line-selected",insertArgHtml:t.lineArg.bind(t)},{chinese:"曲线",selectedClassName:"line-selected",english:"",args:[1,2,3,4,5],insertArgHtml:t.lineArg.bind(t)},{chinese:"矩形",english:"",args:[1,2,3],selectedClassName:"close-selected",insertArgHtml:t.closeRect.bind(t)},{chinese:"多边形",english:"",selectedClassName:"close-selected"},{chinese:"椭圆",english:"",selectedClassName:"close-selected"},{chinese:"圆角矩形",english:"",selectedClassName:"close-selected"}],this.useingTool=this.toolTypeName[0],this.tempCanvas=H("#id-canvas-temp"),this.tempContext=this.tempCanvas.getContext("2d"),this.realCanvas=H("#id-canvas-real"),this.realContext=this.realCanvas.getContext("2d"),this.poiStart=[],this.poiEnd=[],this.pressDown=!1,this.clipArea=null,this.clipAreaPoint=[],this.recordText=!1,this.graphicsType=1}},{key:"initFrame",value:function(){for(var t=this.toolTypeName,e="",a=0;a<16;a+=2)var i=24+(n=a%2==0?0:24),o=r=25*-Math.floor(a/2),n="background-position: ".concat(n,"px ").concat(r,"px;"),r="background-position: ".concat(i,"px ").concat(o,"px;"),e=e+(0===a?'<div class="tool selected" title="':'<div class="tool" title="').concat(t[a].chinese,'"><span style="').concat(n,'"></span></div>')+'<div class="tool" title="'.concat(t[a+1].chinese,'"><span style="').concat(r,'"></span></div>');h(".tool-area",e)}},{key:"airBrushArg",value:function(i){var n=this,o="",r=[[16,23],[16,23],[24,23]],l=[40,50,90],s=[{x:8,y:11,points:[{x:7.9821475377736295,y:13.003459286968706},{x:7.658679762421233,y:9.482245424317076},{x:10.318602503459866,y:9.462861819439302},{x:4.484371705002845,y:11.314914508313324},{x:4.310375737068457,y:11.917682761802512},{x:10.46805320041596,y:8.430922979224622},{x:9.80993113985195,y:10.552692314828603},{x:7.711764091683234,y:14.896062835205777},{x:8.374772077719712,y:8.992223056307518},{x:9.69008351180085,y:10.765543884284039},{x:11.491535312738991,y:11.261381266995741},{x:9.891091210366886,y:13.547914405680103},{x:8.429049375257877,y:12.426045364005507},{x:7.784191463155633,y:8.409085250188745},{x:10.533535194143361,y:10.82666276738996},{x:8.4445750671999,y:10.773822795359527},{x:10.369889487228896,y:13.525312795682964},{x:6.300759622923671,y:11.77021790280394},{x:10.813344043634972,y:10.18801512067621},{x:7.915402178775693,y:12.767506255792181},{x:4.6545475170714585,y:11.990706636787577},{x:8.994834022890723,y:14.304904854503066},{x:9.06763895547647,y:14.005754163250074},{x:7.365178359016678,y:12.926831213501117},{x:10.128779478743034,y:10.117267707231523},{x:8.261057077042649,y:12.025799078067454},{x:4.43766131450746,y:11.317596573318836},{x:4.192562034799739,y:9.915344049828535},{x:5.396169567475496,y:12.834952022246942},{x:7.263369554526909,y:9.030876704127017},{x:5.045306242569868,y:13.018529538416983},{x:11.845082383347723,y:12.101026150029139},{x:11.225824114061554,y:9.026931780840327},{x:6.655695867236627,y:7.577157997988927},{x:5.005406176177926,y:9.696205710933517},{x:7.919345896697198,y:8.447670957064396},{x:6.025153234459006,y:13.072672534009948},{x:4.789270027957695,y:12.501351755484915},{x:7.821735129948005,y:11.555267348624204},{x:4.461990441190974,y:12.263053640553188}]},{x:8,y:11,points:[{x:9.228858332611509,y:15.41629637266577},{x:5.1487288876131965,y:9.447378300005948},{x:12.330920347891915,y:11.490458061630367},{x:3.077538035222684,y:8.426765396320832},{x:13.604731156028821,y:9.395969716860584},{x:10.996457675003281,y:13.389351802763876},{x:8.89165012946322,y:13.5459922682786},{x:6.761368238454256,y:15.173996934125888},{x:6.009127012211446,y:16.292926052961647},{x:6.406600449750185,y:8.443502766730742},{x:3.0372167528977068,y:7.72418144722556},{x:6.14551561494165,y:8.59819295267847},{x:12.125014018449068,y:12.983639113108204},{x:8.727332103065102,y:7.94580808497592},{x:4.165597006245392,y:15.38825815846498},{x:9.011070345972486,y:9.321559542262433},{x:6.273469026752452,y:8.280313004382782},{x:5.036492873495192,y:13.98715075767149},{x:11.655978485019109,y:10.238857911061832},{x:2.7298908402415805,y:9.897151515799237},{x:10.496835932228208,y:10.02637201933593},{x:12.04942187719978,y:7.681003432631823},{x:7.441816720755081,y:7.743738843202819},{x:7.121312818700873,y:14.039547334161835},{x:12.235985471592311,y:13.513691450450374},{x:12.037731255580956,y:12.423634994027292},{x:10.232397421548967,y:14.58637522121731},{x:9.583012239152485,y:13.393894961136535},{x:5.373063563177807,y:9.714563223336908},{x:4.767024176451633,y:14.652967794674675},{x:6.875431471990118,y:11.294512471048565},{x:10.232123371919794,y:12.817177187917416},{x:7.894035515764224,y:12.033241704774529},{x:6.117840515145415,y:12.63844451252389},{x:5.782232758817318,y:13.052690842893295},{x:7.843714519295813,y:16.516887859367145},{x:5.625156069003632,y:11.392418179968768},{x:5.873386753680368,y:5.978573997245552},{x:9.885202309832348,y:6.141770805498193},{x:3.5930698435657913,y:12.791035433407753},{x:10.440800479747654,y:12.040065549823849},{x:5.473561392466695,y:8.547460449098788},{x:10.93134223992612,y:15.127236141778043},{x:5.054854614745872,y:5.946009470359246},{x:10.27667889136763,y:9.19781158787896},{x:6.569618033485516,y:6.307374673434775},{x:6.91648779704595,y:14.035948327342048},{x:7.8707072722196,y:10.72842423507026},{x:11.121086748007501,y:9.69724444625085},{x:13.504491320650104,y:10.028349366691014}]},{x:12,y:11,points:[{x:21.27561399088014,y:15.739563644754927},{x:14.89579055116007,y:19.21208182368494},{x:21.978512748510433,y:10.100822697558664},{x:8.83821622446034,y:7.1196997411811545},{x:13.358956281697429,y:20.317673235483706},{x:20.72834186341835,y:4.548838878846991},{x:8.250967435965187,y:20.33177328641771},{x:4.277564723123928,y:17.524268641183195},{x:9.63444636263379,y:11.406826699891784},{x:14.109002630320493,y:11.427187100681412},{x:4.615305265675667,y:10.53389194727198},{x:21.111404183947826,y:9.640549100991244},{x:19.46039439229392,y:8.964356521334},{x:13.403337719627576,y:5.819327608401341},{x:4.737237377902025,y:9.679623853904463},{x:10.622275648439878,y:15.677330081729876},{x:10.259958902261898,y:17.213115201058216},{x:7.811477702915555,y:20.396608965324667},{x:12.444350883076577,y:2.534013993132795},{x:7.872633997856218,y:7.4071448331669245},{x:15.117594038263118,y:14.213186917756028},{x:15.850113504614399,y:20.858191439922745},{x:16.897420016167597,y:2.7972702502228484},{x:18.64550987682934,y:11.277831975155673},{x:19.507644553858988,y:15.851904426510089},{x:13.63720648282121,y:1.8764590457405013},{x:14.677907494253871,y:13.310417578832396},{x:11.818569460629638,y:1.027092976901801},{x:12.921656574392902,y:20.43727771438792},{x:17.03026760434923,y:17.032201349288915},{x:21.870146779607452,y:14.795833245164996},{x:11.792135362862572,y:9.072356203565821},{x:3.932195502513647,y:9.082745426083878},{x:5.136522366695654,y:6.8528208621122495},{x:18.175304927217248,y:19.002072582020087},{x:6.550312967575236,y:20.26128794744598},{x:6.4374681384132035,y:19.44021018771128},{x:19.39328181558463,y:9.804386857597411},{x:16.672382303891442,y:4.102906975523664},{x:21.57595508478058,y:6.2266515206080815},{x:19.67944584505406,y:14.67268265724637},{x:4.704449938207089,y:6.903534869366467},{x:9.349585803609202,y:13.963208751084423},{x:21.60161207434107,y:14.86773005899474},{x:9.485848516445078,y:10.919474742877787},{x:20.42178054851406,y:8.170576413953363},{x:19.01308804925984,y:18.75798611757616},{x:17.55176967015594,y:19.160190922881362},{x:15.052674093411612,y:10.195576550474652},{x:7.978227061167786,y:8.593249783621916},{x:12.16878639158394,y:16.81915932587647},{x:4.578662785544866,y:18.56465367122104},{x:14.455086634709287,y:17.878568264442432},{x:11.122144094267009,y:14.868165821106693},{x:20.584359060037652,y:16.596880478338903},{x:9.283329810692367,y:1.4430916062773815},{x:9.608253212283095,y:7.641144488471827},{x:5.375228073186648,y:5.012991059293668},{x:2.618192045897265,y:5.7168779203545945},{x:3.5010877782408056,y:4.378094092412298},{x:16.299213358394915,y:3.468416988257026},{x:17.723234370678394,y:2.8399285691916187},{x:5.8291243165732345,y:8.033287032275188},{x:7.911373444551524,y:16.746359092889556},{x:11.129958615186247,y:17.49781831629336},{x:10.634878842332112,y:8.044833394949787},{x:19.120218747244824,y:6.682586755307673},{x:7.74388503953055,y:6.818473173442524},{x:11.555378038334455,y:1.1378463357437205},{x:14.90934301526504,y:18.061668222452486},{x:12.547851456592419,y:4.436710706054136},{x:6.784492158867698,y:18.605774697638974},{x:3.8427136013757353,y:12.823762814894428},{x:17.150459450998632,y:7.325735169462431},{x:5.4075381639596465,y:16.795297286969802},{x:19.485369607424914,y:5.692180087021384},{x:11.461688893613685,y:21.504153464545453},{x:1.0685273746193236,y:11.82585143072542},{x:15.19913456639317,y:5.719180043572365},{x:15.746802871948375,y:18.502762956498692},{x:18.833539174344907,y:8.23398298601538},{x:6.404706837216645,y:11.639089083238098},{x:21.608336855661054,y:13.6185156361802},{x:15.096008877365634,y:8.158696584457068},{x:15.03372475046313,y:6.881883492969081},{x:4.499186412187635,y:14.010176673423581},{x:3.2220712403145253,y:9.078021308816417},{x:17.29950924969838,y:2.4779225900082125},{x:15.424301997392032,y:12.264667024384595},{x:8.097364026795294,y:19.419153370174993}]}],c=[4,6,11],t=(i.args.forEach(function(t,e){var a=0===e?i.selectedClassName:"",a='<div class="airBrushLine arg '.concat(a,'" data-arg="').concat(e,'"><canvas width="').concat(r[e][0],'" height="').concat(r[e][1],'"></canvas></div>');o+=a}),'<div class="choose-brush choose-airbrush-size">'.concat(o,"</div>"));h(".tool-arg",t),this.nowArgIndex=0,B(".airBrushLine canvas").forEach(function(t,e){var a=t.getContext("2d");a.fillStyle="black",0===e&&(a.fillStyle="white");for(var i,o=0;o<l[e];o++)s[e].points.length===l[e]?i=s[e].points[o]:(i=n.randomPoi(s[e],c[e]),s[e].points.push(i)),a.fillRect(i.x,i.y,1,1)}),console.log("circleHeart",s),this.useingTool.circleHeart=s}},{key:"randomPoi",value:function(t,e){for(var a=null,i=t.x-e,o=t.y-e;!a;){var n=i+Math.random()*e*2,r=o+Math.random()*e*2;Math.pow(n-t.x,2)+Math.pow(r-t.y,2)<e*e&&(a={x:n,y:r})}return a}},{key:"closeRect",value:function(t){t='<div class="arg closeRect '.concat(t.selectedClassName,'" data-arg="0"><canvas width="39" height="21"></canvas></div>'),t='<div class="chooser choose-shape-style">'.concat(t).concat('<div class="arg closeRect" data-arg="1"><canvas width="39" height="21"></canvas></div>').concat('<div class="arg closeRect" data-arg="2"><canvas width="39" height="21"></canvas></div>',"</div>"),h(".tool-arg",t),this.nowArgIndex=0,B(".choose-shape-style canvas").forEach(function(t,e){t=t.getContext("2d"),0===e?(t.lineWidth=2,t.strokeStyle="white",t.strokeRect(4,4,30,12)):1===e?(t.strokeStyle="black",t.fillStyle="gray",t.strokeRect(4,4,30,12),t.fillRect(5,5,28,10)):(t.fillStyle="gray",t.fillRect(5,5,29,11))})}},{key:"brushArg",value:function(o){var n="",t=(o.args.forEach(function(t,i){(t=j(Object.entries(t)[0],2))[0],t[1].forEach(function(t,e){var a=0===i&&0===e?o.selectedClassName:"",a='<div class="brushLine arg '.concat(a,'" data-arg="').concat(i,"-").concat(e,'"><canvas width="10" height="10"></canvas></div>');n+=a})}),'<div class="chooser choose-brush">'.concat(n,"</div>")),r=(h(".tool-arg",t),this.nowArgIndex=[0,0],B(".brushLine canvas"));o.args.forEach(function(t,i){var o=(t=j(Object.entries(t)[0],2))[0];t[1].forEach(function(t,e){var a=r[3*i+e].getContext("2d");a.fillStyle="black",a.strokeStyle="black",0===i&&0===e&&(a.fillStyle="white",a.strokeStyle="white"),"十字圆"===o?(console.log("v",t),a.arc(5,5,t,0,2*Math.PI,!1),a.fill()):"方形"===o?(a.fillRect(e=(10-t)/2,e,t,t),a.fill()):"左撇"===o?(e=Math.floor(10-t)/2,a.moveTo(e,t+e),a.lineTo(e+t,e),a.stroke()):"右撇"===o&&(e=Math.floor(10-t)/2,a.moveTo(e,e),a.lineTo(e+t,e+t),a.stroke())})})}},{key:"magnifierArg",value:function(o){var n="",t=(o.args.forEach(function(t,e){var a=0===e?o.selectedClassName:"",i="width: ".concat(t.w,"px; height: ").concat(t.w,"px;"),a='<div class="magnifierLine arg '.concat(a,'" data-arg="').concat(e,'">\n<div class="text">').concat(t.x,'x</div>\n<div class="dot" style="').concat(i,'"></div>\n</div>');n+=a}),'<div class="chooser choose-magnification">'.concat(n,"</div>"));h(".tool-arg",t),this.nowArgIndex=0}},{key:"eraserArg",value:function(i){var o="",t=(i.args.forEach(function(t,e){var a=0===e?i.selectedClassName:"",t="width: ".concat(t,"px; height: ").concat(t,"px;"),a='<div class="eraserLine arg '.concat(a,'" data-arg="').concat(e,'"><div style="').concat(t,'"></div></div>');o+=a}),'<div class="chooser choose-eraser">'.concat(o,"</div>"));h(".tool-arg",t),this.nowArgIndex=0}},{key:"lineArg",value:function(t){for(var e=[1,2,3,4,5],a="",i=0;i<5;i++){var o=0===i?t.selectedClassName:"";a+='<div class="arg line '.concat(o,'" data-arg="').concat(e[i],'"><div class="" style="width: 30px; height: ').concat(e[i],'px"></div></div>')}var n='<div class="chooser choose-stroke-size">'.concat(a,"</div>");h(".tool-arg",n),this.nowArgIndex=0}},{key:"switchToolArg",value:function(e){var a=this,t=(H(".selected").classList.remove("selected"),e.classList.add("selected"),["直线","曲线"]),i=["矩形","椭圆","多边形","圆角矩形"];t.includes(this.useingTool.chinese)&&t.includes(e.title)||i.includes(this.useingTool.chinese)&&i.includes(e.title)?this.useingTool=this.toolTypeName.find(function(t){return t.chinese===e.title}):(H(".tool-arg").innerHTML="",this.useingTool=this.toolTypeName.find(function(t){return t.chinese===e.title}),(t=this.toolTypeName.find(function(t){return t.chinese===a.useingTool.chinese})).insertArgHtml&&t.insertArgHtml(t))}},{key:"swatchColor",value:function(){var t=this.lineColor;this.lineColor=this.fillColor,this.fillColor=t,H(".lineColor").style["background-color"]=this.lineColor,H(".fillColor").style["background-color"]=this.fillColor}},{key:"addListener",value:function(){var N=this,O=0;H(".swatch").addEventListener("click",function(t){N.swatchColor()}),H(".palette").addEventListener("click",function(t){console.log("click");var e=t.target.closest(".color-button"),e=Number(e.dataset.index);N.lineColor=N.colorlist[e],H(".lineColor").style["background-color"]=N.lineColor,N.realContext.strokeStyle=N.lineColor,t.preventDefault()}),H(".palette").addEventListener("dblclick",function(t){t.preventDefault(),console.log("dbclick",t.target);var e=document.createEvent("MouseEvents");e.initEvent("click",!1,!0),t.target.dispatchEvent(e)}),H(".palette").addEventListener("change",function(t){console.log("change",t.target,t.target.value),N.lineColor=t.target.value,H(".lineColor").style["background-color"]=N.lineColor}),H(".tool-area").addEventListener("click",function(t){t=t.target.closest(".tool"),N.paintTool.initCurveConfig(),t.classList.contains(".selected")||(H(".selected").classList.remove("selected"),t.classList.add("selected"),N.switchToolArg(t))}),H(".tool-arg").addEventListener("click",function(t){var t=t.target,e=null,a=N.useingTool.selectedClassName;if(!(e=t.classList.contains("arg")?t:t.closest(".arg")).classList.contains(a)){if("笔刷"===N.useingTool.chinese){for(var i,o,n=H(".".concat(a)).querySelector("canvas").getContext("2d"),t=(n.fillStyle="black",n.strokeStyle="black",N.nowArgIndex[0]),r=N.nowArgIndex[1],l=(t=j(Object.entries(N.useingTool.args[t])[0],2))[0],s=t[1][r],c=e.querySelector("canvas").getContext("2d"),t=e.dataset.arg.split("-"),r=Number(t[0]),t=Number(t[1]),h=Object.keys(N.useingTool.args[r])[0],g=(c.fillStyle="white",c.strokeStyle="white",N.useingTool.args[r][h][t]),d="",u=null,y=0,p=0;p<2;p++)0===p&&(d=l,y=s,u=n),1===p&&(d=h,y=g,u=c),u.clearRect(0,0,10,10),"十字圆"===d?(u.arc(5,5,y,0,2*Math.PI),u.fill()):"方形"===d?(u.fillRect(i=(10-y)/2,i,y,y),u.fill()):"左撇"===d?(i=Math.floor(10-y)/2,u.moveTo(i,y+i),u.lineTo(i+y,i),u.stroke()):"右撇"===d&&(o=Math.floor(10-y)/2,u.moveTo(o,o),u.lineTo(o+y,o+y),u.stroke());N.nowArgIndex=[r,t],console.log("this.nowArgIndex",N.nowArgIndex),N.bihshuaname=["十字圆","方形","左撇","右撇"][N.nowArgIndex[0]],N.bishuaArg=[6,4,2][N.nowArgIndex[1]]}else if("喷枪"===N.useingTool.chinese){var f=H(".".concat(a)).querySelector("canvas").getContext("2d"),r=(f.fillStyle="black",f.clearRect(0,0,100,100),N.nowArgIndex),x=(console.log("typeIndex",r),N.useingTool.circleHeart[r].points.forEach(function(t){f.fillRect(t.x,t.y,1,1)}),e.querySelector("canvas").getContext("2d")),t=Number(e.dataset.arg);x.fillStyle="white",N.useingTool.circleHeart[t].points.forEach(function(t){x.fillRect(t.x,t.y,1,1)}),console.log("arg",t),N.nowArgIndex=t}else if(N.useingTool.chinese.includes("形")){var r=Number(e.dataset.arg),t=(console.log("arg",r),N.graphicsType=r+1,N.nowArgIndex),v=(m=B(".choose-shape-style canvas"))[t].getContext("2d");v.clearRect(0,0,100,100),0===t?(v.lineWidth=2,v.strokeStyle="black",v.strokeRect(4,4,30,12)):1===t?(v.lineWidth=2,v.strokeStyle="black",v.fillStyle="gray",v.strokeRect(4,4,30,12),v.fillRect(5,5,28,10)):(v.fillStyle="gray",v.fillRect(5,5,29,11)),(m=m[r].getContext("2d")).clearRect(0,0,100,100),v=m,0===(t=r)?(v.lineWidth=2,v.strokeStyle="white",v.strokeRect(4,4,30,12)):1===t?(v.lineWidth=2,v.strokeStyle="white",v.fillStyle="gray",v.strokeRect(4,4,30,12),v.fillRect(5,5,28,10)):(v.fillStyle="gray",v.fillRect(5,5,29,11)),N.nowArgIndex=r}else if(N.nowArgIndex=Number(e.dataset.arg),console.log("this.nowArgIndex",N.nowArgIndex),N.graphicsType=N.nowArgIndex+1,"放大镜"===N.useingTool.chinese){if(N.nowArgIndex===O)return;for(var m,C=N.realCanvas.width,w=N.realCanvas.height,k=(m=[1,2,6,8])[O%m.length],T=m[O=N.nowArgIndex%m.length],b=(console.log("targetScaleNumber",T,"curScaleNumber",k),console.time("计时"),console.log("w",C,"h",w,"w*curScaleNumber",C*k,"h*curScaleNumber",w*k),N.realContext.getImageData(0,0,C*k,w*k).data),S=[],P=0;P<w*k;P+=k){for(var A=[],D=0;D<C*k;D+=k)for(var I=b[4*(P*C*k+D)-1+1],R=b[4*(P*C*k+D)-1+2],M=b[4*(P*C*k+D)-1+3],L=b[4*(P*C*k+D)-1+4],E=0;E<T;E++)A.push.apply(A,[I,R,M,L]);for(var W=0;W<T;W++)S.push.apply(S,A)}t=new ImageData(Uint8ClampedArray.from(S),C*T,w*T),console.timeEnd("计时"),N.realCanvas.width=C/k*T,N.realCanvas.height=w/k*T,N.tempCanvas.width=C/k*T,N.tempCanvas.height=w/k*T,N.tempContext.clearRect(0,0,C*T,w*T),N.realContext.clearRect(0,0,C*T,w*T),N.realContext.putImageData(t,0,0)}"直线"!==N.useingTool.chinese&&"曲线"!==N.useingTool.chinese||(N.lineWidth=N.lineWidthArr[N.nowArgIndex-1],console.log("this.lineWidth",N.lineWidth)),H(".".concat(a)).classList.remove(a),e.classList.add(a)}}),H(".menu-container").addEventListener("click",function(t){1==t.target.dataset.index&&N.paintTool.saveImg()})}},{key:"setRecordText",value:function(t){this.recordText=t}},{key:"listenCanvas",value:function(){var p=this,f=this.pressDown,x=this.poiStart,v=this.poiEnd,m=this.tempCanvas,C=this.tempContext,w=(this.realCanvas,this.realContext),k=null,T=[3,7,12];window.addEventListener("keydown",function(t){var e,a,i;p.recordText&&(e=p.paintTool.textareaPoi,t=t.key,e.stringArr.length||(e.stringArr=[{start:[],text:""}]),a=e.stringArr.length,i=(a=e.stringArr[a-1]).text+t,C.measureText(i).width<e.end[0]-e.start[0]?a.text=i:e.stringArr.push({start:[],text:t}))}),m.addEventListener("mousedown",function(t){p.lineWidth;var e,a,i,o,n,r=p.useingTool.chinese,l=t.offsetX,s=t.offsetY;x=[l,s],f=!0,"曲线"===r?p.paintTool.curveStrightLineExist&&(C.clearRect(0,0,m.width,m.height),(a=p.paintTool.curvePoint).cp1.length?(a.cp2.length?(p.paintTool.changeCpPoint=(i=a.cp1,o=a.cp2,n=x,Math.pow(n[0]-i[0],2)+Math.pow(n[1]-i[1],2)<Math.pow(n[0]-o[0],2)+Math.pow(n[1]-o[1],2)?"cp1":"cp2"),a[p.paintTool.changeCpPoint]=[l,s]):(p.paintTool.changeCpPoint="cp2",a.cp2=[l,s]),p.paintTool.useCurve3(C,a.start,a.end,a.cp1,a.cp2)):(p.paintTool.changeCpPoint="cp1",p.paintTool.curvePoint.cp1=[l,s],p.paintTool.useCurve2(C,a.start,a.end,a.cp1))):"取色器"===r?(i=(i=w).getImageData(l,s,1,1).data,"rgba(".concat(i[0],", ").concat(i[1],", ").concat(i[2],", ").concat(i[3]/255,")"),a="rgb(".concat(i[0],", ").concat(i[1],", ").concat(i[2],")"),H(".lineColor").style.background=a,p.lineColor=a):"多边形"===r?p.paintTool.polygonLine.length&&(a=p.paintTool.polygonLine[p.paintTool.polygonLine.length-1].end,p.paintTool.polygonLine.push({start:a,end:b(x)}),p.paintTool.usePolygon(C,a,x,!1,p.lineColor,p.fillColor)):"喷枪"===r?(w.fillStyle=p.fillColor,R(w,[l,s],T[p.nowArgIndex]),clearInterval(k),p.penhuCurCount=0,k=setInterval(function(){p.penhuCurCount>p.penhuCount?(p.penhuCurCount=0,clearInterval(k)):(p.penhuCurCount+=1,R(w,[l,s],T[p.nowArgIndex]))},200)):"笔刷"===r?(w.fillStyle=p.lineColor,p.bihshuaname=["十字圆","方形","左撇","右撇"][p.nowArgIndex[0]],p.bishuaArg=[6,4,2][p.nowArgIndex[1]],I(w,[l,s],[],"down",p.bihshuaname,p.bishuaArg)):"文字"===r?(C.strokeStyle=p.lineColor,p.paintTool.useText(C,x,v,"down")):"矩形剪切"===r?p.paintTool.useRectClip(C,x,v,"down"):"不规则剪切"===r?(console.log("down 不规则剪切"),p.paintTool.useRandomClip(C,x,v,"down")):"橡皮擦"===r?(console.log("down 橡皮擦"),a=p.useingTool.args[p.nowArgIndex],w.fillStyle=p.fillColor,console.log("realContext.fillStyle",w.fillStyle),e=t.offsetX-a/2,t=t.offsetY-a/2,console.log(e,t,a,a),w.fillRect(e,t,a,a)):"填充"===r&&(t=[(e=w.getImageData(l,s,1,1)).data[0],e.data[1],e.data[2],e.data[3]],a=[],console.time("start"),w.strokeStyle=p.fillColor,N({x:l,y:s},t,{},a,w,m),a.forEach(function(t){w.moveTo(t.left.x,t.left.y),w.lineTo(t.right.x,t.right.y),w.stroke()}),console.timeEnd("start"))}),m.addEventListener("mousemove",function(t){var e,a,i=p.useingTool.chinese,o=p.lineColor,n=p.fillColor,r=p.lineWidth;if("橡皮擦"===i){v=[t.offsetX,t.offsetY];var l=p.useingTool.args[p.nowArgIndex],s=(console.log("eraserWidth",l),t.offsetX-l/2),c=t.offsetY-l/2;if(f)if(l*l<Math.pow(v[0]-x[0],2)+Math.pow(v[1]-x[1],2))for(var h=x[0],g=x[1],d=v[0],u=v[1],y=5;y<=100;y+=5)w.fillRect(h+y/100*(d-h)-l/2,g+y/100*(u-g)-l/2,l,l);else w.fillRect(s,c,l,l);else C.clearRect(0,0,m.width,m.height),C.fillStyle=p.fillColor,C.fillRect(s,c,l,l);x=[t.offsetX,t.offsetY]}else f&&(C.clearRect(0,0,m.width,m.height),e=t.offsetX,a=t.offsetY,v=[e,a],"铅笔"===i?(p.paintTool.usePencil(w,x,v,1,o),x=[e,a]):"直线"===i?(p.paintTool.dashMode(!1),S(C,x,v,r,o)):"曲线"===i?(s=p.paintTool.curvePoint,p.paintTool.curveStrightLineExist?(p.paintTool.curvePoint[p.paintTool.changeCpPoint]=[e,a],p.paintTool.curvePoint.cp2.length?p.paintTool.useCurve3(C,s.start,s.end,s.cp1,s.cp2):p.paintTool.useCurve2(C,s.start,s.end,s.cp1)):S(C,x,v,r,o)):"矩形"===i?D(C,x,v,p.graphicsType,o,n):"椭圆"===i?P(C,x,v,p.graphicsType,o,n):"多边形"===i?(c=[],c=p.paintTool.polygonLine.length?p.paintTool.polygonLine[p.paintTool.polygonLine.length-1].start:x,p.paintTool.usePolygon(C,c,v,!1,o,n)):"圆角矩形"===i?A(C,x,v,p.graphicsType,o,n):"喷枪"===i?(w.fillStyle=p.fillColor,R(w,[e,a],T[p.nowArgIndex]),clearInterval(k),p.penhuCurCount=0,k=setInterval(function(){!f||p.penhuCurCount>p.penhuCount?clearInterval(k):(p.penhuCurCount+=1,R(w,[e,a],T[p.nowArgIndex]))},200)):"笔刷"===i?(w.fillStyle=p.lineColor,I(w,x,v,"move",p.bihshuaname,p.bishuaArg),x=[e,a]):"文字"===i?(C.strokeStyle=p.lineColor,p.paintTool.useText(C,x,v,"move")):"矩形剪切"===i?p.paintTool.useRectClip(C,x,v,"move"):"不规则剪切"===i&&p.paintTool.useRandomClip(C,x,v,"move"))}),m.addEventListener("mouseup",function(t){var e,a,i,o=p.useingTool.chinese,n=p.lineColor,r=p.fillColor,l=p.lineWidth,s=(f=!1,t.offsetX),t=t.offsetY;v=[s,t],C.clearRect(0,0,m.width,m.height),"铅笔"===o?p.paintTool.usePencil(w,x,v,1,n):"直线"===o?S(w,x,v,l,n):"橡皮擦"!==o&&("曲线"===o?(e=p.paintTool.curvePoint,p.paintTool.curveStrightLineExist?e.cp2.length?p.paintTool.useCurve3(C,e.start,e.end,e.cp1,e.cp2):p.paintTool.useCurve2(C,e.start,e.end,e.cp1):(p.paintTool.curveStrightLineExist=!0,S(C,x,v,l,n),e.start=b(x),e.end=b(v))):"矩形"===o?D(w,x,v,p.graphicsType,n,r):"椭圆"===o?P(w,x,v,p.graphicsType,n,r):"多边形"===o?p.paintTool.polygonLine.length?(a=p.paintTool.polygonLine[0].start,i=v,Math.pow(a[0]-i[0],2)+Math.pow(a[1]-i[1],2)<100?(l=p.paintTool.polygonLine[p.paintTool.polygonLine.length-1].start,console.log("---",p.paintTool.polygonLine),p.paintTool.usePolygon(w,l,p.paintTool.polygonLine[0].start,!0,n,r),p.paintTool.polygonLine=[]):(console.log("---up"),e=p.paintTool.polygonLine[p.paintTool.polygonLine.length-1].start,p.paintTool.polygonLine[p.paintTool.polygonLine.length-1].end=v,p.paintTool.usePolygon(w,e,v,!1,n,r))):(p.paintTool.polygonLine[0]={start:b(x),end:b(v)},p.paintTool.usePolygon(w,p.paintTool.polygonLine[0].start,p.paintTool.polygonLine[0].end,!1,n,r)):"圆角矩形"===o?A(w,x,v,p.graphicsType,n,r):"喷枪"===o?(w.fillStyle=p.fillColor,R(w,[s,t],T[p.nowArgIndex]),clearInterval(k)):"笔刷"===o?(w.fillStyle=p.lineColor,I(w,x,v,"up",p.bihshuaname,p.bishuaArg)):"文字"===o?(C.strokeStyle=p.lineColor,p.paintTool.useText(C,x,v,"up")):"矩形剪切"===o?p.paintTool.useRectClip(C,x,v,"up"):"不规则剪切"===o&&p.paintTool.useRandomClip(C,x,v,"up"))}),m.addEventListener("mouseleave",function(t){"橡皮擦"===p.useingTool.chinese&&C.clearRect(0,0,m.width,m.height),clearInterval(k)})}},{key:"initBottomColor",value:function(){this.colorlist;var a="";s.forEach(function(t,e){t="background-color: ".concat(t),e='<div class="swatch color-button" data-index="'.concat(e,'" style="').concat(t,'"><input type="color"/></div>'),a+=e}),h(".palette",a)}},{key:"initFrontEndColor",value:function(){var t=[this.colorlist[0],this.colorlist[14]],i=["lineColor","fillColor"];t.forEach(function(t,e){var t="background-color: ".concat(t,"; z-index: 6;"),a=0===e?"color-selection":"",e='<div class="swatch color-button '.concat(i[e]," ").concat(a,'" style="').concat(t,'"></div>');h(".swatch.current-colors",e)})}},{key:"start",value:function(t){this.paintTool=t,this.listenCanvas()}}],[{key:"new",value:function(){for(var t=arguments.length,e=new Array(t),a=0;a<t;a++)e[a]=arguments[a];return i(this,e)}}]);var d;function u(t){e(this,u),this.colorlist=t,this.setup()}function y(t){e(this,y),this.paint=t,this.clipArea=null,this.clipAreaPoint=[],this.recordText=!1,this.textareaPoi={start:[],end:[],txtStart:[],cursorStart:[],txtValue:"",stringArr:[]},this.curveStrightLineExist=!1,this.curvePoint={start:[],end:[],cp1:[],cp2:[]},this.changeCpPoint="",this.curveArr=[],this.graphicsType=1,this.realContextMoveTo=!1,this.polygonLine=[]}d=u.new(s),c=new c(d),d.start(c)})();